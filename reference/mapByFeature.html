<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Map Genomic Ranges to genes using defined features — mapByFeature • extraChIPs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Map Genomic Ranges to genes using defined features — mapByFeature"><meta property="og:description" content="Map Genomic Ranges to genes using defined regulatory features"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">extraChIPs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/range_based_functions.html">Range-based Operations</a>
    </li>
    <li>
      <a href="../articles/differential_signal.html">Differential Signal Analysis</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/smped/extraChIPs" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Map Genomic Ranges to genes using defined features</h1>
    <small class="dont-index">Source: <a href="https://github.com/smped/extraChIPs/blob/HEAD/R/mapByFeature.R" class="external-link"><code>R/mapByFeature.R</code></a></small>
    <div class="hidden name"><code>mapByFeature.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Map Genomic Ranges to genes using defined regulatory features</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mapByFeature</span><span class="op">(</span></span>
<span>  <span class="va">gr</span>,</span>
<span>  <span class="va">genes</span>,</span>
<span>  <span class="va">prom</span>,</span>
<span>  <span class="va">enh</span>,</span>
<span>  <span class="va">gi</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gene_id"</span>, <span class="st">"gene_name"</span>, <span class="st">"symbol"</span><span class="op">)</span>,</span>
<span>  gr2prom <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  gr2enh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  gr2gi <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  gr2gene <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  prom2gene <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  enh2gene <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  gi2gene <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>gr</dt>
<dd><p>GRanges object with query ranges to be mapped to genes</p></dd>


<dt>genes</dt>
<dd><p>GRanges object containing genes (or any other nominal feature)
to be assigned</p></dd>


<dt>prom</dt>
<dd><p>GRanges object defining promoters</p></dd>


<dt>enh</dt>
<dd><p>GRanges object defining Enhancers</p></dd>


<dt>gi</dt>
<dd><p>GInteractions object defining interactions. Mappings from
interactions to genes should be performed as a separate prior step.</p></dd>


<dt>cols</dt>
<dd><p>Column names to be assigned as mcols in the output. Columns
must be minimally present in <code>genes</code>. If all requested columns are found in
any of prom, enh or gi, these pre-existing mappings will be preferentially
used. Any columns not found in utilised reference objects will be ignored.</p></dd>


<dt>gr2prom</dt>
<dd><p>The maximum permissible distance between a query range and
any ranges defined as promoters</p></dd>


<dt>gr2enh</dt>
<dd><p>The maximum permissible distance between a query range and
any ranges defined as enhancers</p></dd>


<dt>gr2gi</dt>
<dd><p>The maximum permissible distance between a query range and
any ranges defined as GInteraction anchors</p></dd>


<dt>gr2gene</dt>
<dd><p>The maximum permissible distance between a query range and
genes (for ranges not otherwise mapped)</p></dd>


<dt>prom2gene</dt>
<dd><p>The maximum permissible distance between a range provided
in <code>prom</code> and a gene</p></dd>


<dt>enh2gene</dt>
<dd><p>The maximum permissible distance between a range provided
in <code>enh</code> and a gene</p></dd>


<dt>gi2gene</dt>
<dd><p>The maximum permissible distance between a GInteractions
anchor (provided in <code>gi</code>) and a gene</p></dd>


<dt>...</dt>
<dd><p>Passed to findOverlaps and overlapsAny internally</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A GRanges object with added mcols as specified</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is able to utilise feature-level information and long-range
interactions to enable better mapping of regions to genes. If provided, this
essentially maps from ranges to genes using the regulatory features as a
framework. The following sequential strategy is used:</p>
<ol><li><p>Ranges overlapping a promoter are assigned to that gene</p></li>
<li><p>Ranges overlapping an enhancer are assigned to <strong>all genes</strong> within
a specified distance</p></li>
<li><p>Ranges overlapping a long-range interaction are assigned to all genes
connected by the interaction</p></li>
<li><p>Ranges with no gene assignment from the previous steps are assigned
to <em>all overlapping genes</em> or the nearest gene within a specified distance</p></li>
</ol><p>If information is missing for one of these steps, the algorithm will simply
proceed to the next step. If no promoter, enhancer or interaction data is
provided, all ranges will be simply mapped by step 4.
Ranges can be mapped by any or all of the first three steps, but step 4 is
mutually exclusive with the first 3 steps.</p>
<p>Distances between each set of features and the query range can be
individually specified by modifying the <code>gr2prom</code>, <code>gr2enh</code>, <code>gr2gi</code> or
<code>gr2gene</code> parameters. Distances between features and genes can also be set
using the parameters <code>prom2gene</code>, <code>enh2gene</code> and <code>gi2gene</code>.</p>
<p>Additionally, if previously defined mappings are included with any of the
<code>prom</code>, <code>enh</code> or <code>gi</code> objects, this will be used in preference to any
obtained from the <code>genes</code> object.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Define some genes</span></span></span>
<span class="r-in"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr1:2-10:*"</span>, <span class="st">"chr1:25-30:-"</span>, <span class="st">"chr1:31-40:+"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">genes</span><span class="op">$</span><span class="va">gene_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"gene"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">genes</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 3 ranges and 1 metadata column:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand |     gene_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]     chr1      2-10      * |       gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]     chr1     25-30      - |       gene2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [3]     chr1     31-40      + |       gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span><span class="co">## Add a promoter for each gene</span></span></span>
<span class="r-in"><span><span class="va">prom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/intra-range-methods.html" class="external-link">promoters</a></span><span class="op">(</span><span class="va">genes</span>, upstream <span class="op">=</span> <span class="fl">1</span>, downstream <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prom</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 3 ranges and 1 metadata column:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand |     gene_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]     chr1       1-2      * |       gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]     chr1     30-31      - |       gene2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [3]     chr1     30-31      + |       gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span><span class="co">## Some ranges to map</span></span></span>
<span class="r-in"><span><span class="va">gr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"chr1:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gr</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 5 ranges and 0 metadata columns:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]     chr1         0      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]     chr1        15      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [3]     chr1        30      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [4]     chr1        45      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [5]     chr1        60      *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Map so that any gene within 25bp of the range is assigned</span></span></span>
<span class="r-in"><span><span class="fu">mapByFeature</span><span class="op">(</span><span class="va">gr</span>, <span class="va">genes</span>, gr2gene <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 5 ranges and 1 metadata column:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand |         gene_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;CharacterList&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]     chr1         0      * |           gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]     chr1        15      * |           gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [3]     chr1        30      * |           gene2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [4]     chr1        45      * |           gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [5]     chr1        60      * |           gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now use promoters to be more accurate in the gene assignment</span></span></span>
<span class="r-in"><span><span class="co">## Given that the first range overlaps the promoter of gene1, this is a</span></span></span>
<span class="r-in"><span><span class="co">## more targetted approach. Similarly for the third range</span></span></span>
<span class="r-in"><span><span class="fu">mapByFeature</span><span class="op">(</span><span class="va">gr</span>, <span class="va">genes</span>, <span class="va">prom</span>, gr2gene <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GRanges object with 5 ranges and 1 metadata column:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       seqnames    ranges strand |         gene_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;CharacterList&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]     chr1         0      * |           gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [2]     chr1        15      * |           gene1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [3]     chr1        30      * |     gene2,gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [4]     chr1        45      * |           gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [5]     chr1        60      * |           gene3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stephen Pederson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

