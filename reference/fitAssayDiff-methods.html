<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detect Differential ChIP Signal — fitAssayDiff • extraChIPs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Detect Differential ChIP Signal — fitAssayDiff"><meta property="og:description" content="Detect differential ChIP signal using one of many approaches"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">extraChIPs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/range_based_functions.html">Range-based Operations</a>
    </li>
    <li>
      <a href="../articles/differential_signal_sliding.html">Differential Signal Using Sliding Windows</a>
    </li>
    <li>
      <a href="../articles/differential_signal_fixed.html">Differential Signal Using Fixed-Width Windows</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/smped/extraChIPs" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detect Differential ChIP Signal</h1>
    <small class="dont-index">Source: <a href="https://github.com/smped/extraChIPs/blob/HEAD/R/fitAssayDiff.R" class="external-link"><code>R/fitAssayDiff.R</code></a></small>
    <div class="hidden name"><code>fitAssayDiff-methods.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Detect differential ChIP signal using one of many approaches</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitAssayDiff</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for SummarizedExperiment</span></span>
<span><span class="fu">fitAssayDiff</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  assay <span class="op">=</span> <span class="st">"counts"</span>,</span>
<span>  design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coef <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lib.size <span class="op">=</span> <span class="st">"totals"</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qlf"</span>, <span class="st">"lt"</span><span class="op">)</span>,</span>
<span>  norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"TMM"</span>, <span class="st">"RLE"</span>, <span class="st">"TMMwsp"</span>, <span class="st">"upperquartile"</span><span class="op">)</span>,</span>
<span>  groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lfc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">fc</span><span class="op">)</span>,</span>
<span>  asRanges <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="st">"worst.case"</span><span class="op">)</span>,</span>
<span>  weighted <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a SummarizedExperiment object</p></dd>


<dt>...</dt>
<dd><p>Passed to <a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a> and
<a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFit</a> when method = "qlf".
If method = "lt", instead passed to <a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">lmFit</a>, <a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">treat</a>,
<a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">eBayes</a></p></dd>


<dt>assay</dt>
<dd><p>The assay to use for analysis</p></dd>


<dt>design</dt>
<dd><p>The design matrix to use for analysis</p></dd>


<dt>coef</dt>
<dd><p>The required column from the design matrix</p></dd>


<dt>lib.size</dt>
<dd><p>The column within the colData element which contains the
library size information. If set to NULL, column summaries will be used.</p></dd>


<dt>method</dt>
<dd><p>the analytic method to be used. Can be 'qlf' which will fit
counts using the <a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFit</a> strategy , or 'lt' which fits the
<a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">limma-trend</a> model on logCPM, or pre-processed logCPM
values</p></dd>


<dt>norm</dt>
<dd><p>The normalisation strategy to use when running the
glmQLF models. The value 'none' relies solely on library-size normalisation,
and is the default. All methods available in <a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a>
are implemented. Ignored when using method = "lt"</p></dd>


<dt>groups</dt>
<dd><p>character(1) If a column name is supplied here, group-based
normalisation will be applied to GLM models treating data in this column
as a grouping factor. Ignored when using method = "lt"</p></dd>


<dt>fc, lfc</dt>
<dd><p>Thresholds passed to <a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">treat</a> or
<a href="https://rdrr.io/pkg/edgeR/man/glmTreat.html" class="external-link">glmTreat</a></p></dd>


<dt>asRanges</dt>
<dd><p>logical(1). By default, the returned object will be a
<code>SummarizedExperiment</code> object with the results added to the <code>rowData</code>
element. Setting <code>asRanges = TRUE</code> will only return the GRanges object from
this element</p></dd>


<dt>offset</dt>
<dd><p>If provided will be used as the offset when the DGEList object
is created during model fitting</p></dd>


<dt>null</dt>
<dd><p>Passed to <a href="https://rdrr.io/pkg/edgeR/man/glmTreat.html" class="external-link">glmTreat</a></p></dd>


<dt>weighted</dt>
<dd><p>logical(1) Passed to  <a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A SummarizedExperiment object with results set as the <code>rowData</code> element.
Any existing columns not contained in the differential ChIP results will be
retained.
Results from testing will contain logCPM, logFC, PValue and the t/F
statistic as appropriate, along with an FDR-adjusted p-value</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Starting with a SummarizedExperiment object this function fits either a
<a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFit</a> model to count data, or the
<a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">limma-trend</a> model to logCPM data.</p>
<p>If fitting Generalised Linear Models via glmQLFit, options for normalisation
are "none", which normalises to library size. Existing library sizes are
commonly found in the "totals" column of the colData element and this is
attempted by default. All methods provided in <a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a>
are also implemented, with the added possibility of normalising within groups
instead of across the entire dataset. To enable this, the column with the
grouping factor is expected to be in the colData element and is simply
called by column name.
No normalisation is applied when using the limma-trend model, as this allows
for previous normalisation strategies to be performed on the data.</p>
<p>Normalising to ChIP Input samples, or using offsets is not yet implemented.</p>
<p>Either range-based hypothesis testing is implemented using
<a href="https://rdrr.io/pkg/edgeR/man/glmTreat.html" class="external-link">glmTreat</a> or <a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">treat</a>. Setting fc to 1 (or lfc to 0)
will default to a point-based null hypothesis, equivalent to either
<a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFTest</a> (method = "qlf") or
<a href="https://rdrr.io/pkg/limma/man/ebayes.html" class="external-link">eBayes</a> (method = "lt").</p>
<p>It should also be noted that this is primarily a convenience function and
if requiring intermediate output from any setps, then these can be run
individually as conventionally specified.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">nrows</span> <span class="op">&lt;-</span> <span class="fl">200</span>; <span class="va">ncols</span> <span class="op">&lt;-</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">nrows</span> <span class="op">*</span> <span class="va">ncols</span>, <span class="fl">1</span>, <span class="fl">1e4</span><span class="op">)</span>, <span class="va">nrows</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sample_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">ncols</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">DataFrame</span><span class="op">(</span>treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  assays <span class="op">=</span> <span class="fu">SimpleList</span><span class="op">(</span>counts <span class="op">=</span> <span class="va">counts</span><span class="op">)</span>, colData <span class="op">=</span> <span class="va">df</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">treat</span>, <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu">fitAssayDiff</span><span class="op">(</span><span class="va">se</span>, design <span class="op">=</span> <span class="va">X</span>, lib.size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating DGE list...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating experiment-wide normalisation factors...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating dispersions...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running glmQLFit...</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 200 rows and 5 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          logFC    logCPM           F     PValue       FDR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    4.3066297   11.7021 10.16802466 0.00399995  0.799990</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    0.0834144   12.2407  0.00642621 0.93678278  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    1.6795006   11.6748  1.92608248 0.17814742  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   -1.1910934   12.0524  1.30459678 0.26482720  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    0.5179778   12.0442  0.23548266 0.63196061  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...         ...        ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 196  0.0907519   12.7687  0.02703171  0.8708054  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 197  1.0952799   12.3006  1.13433141  0.2976250  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 198 -1.1430288   12.6072  2.94270952  0.0993631  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 199  0.1461143   12.3253  0.02388492  0.8784917  0.996477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 200  0.0463691   11.8591  0.00110078  0.9738116  0.996477</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stephen Pederson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

